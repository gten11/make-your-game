<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Game</title>
    <link rel ="stylesheet" href ="index.css">
</head>

<body>
    <h1>"Space Invaders"</h1>
    <div id ="game">
        <img id ="asteroid1" src="images/asteroid1.png">
        <img id ="asteroid2" src="images/asteroid2.png">
        <img id ="asteroid3" src="images/asteroid3.png">
        <img id ="asteroid4" src="images/asteroid4.png">
        <img id="myShip" src="images/myShip.png">
        <img id="myShooter" src="images/myShooter.png">
        <img id ="bullet" src="images/bullet.png">

    </div>
</body>

<script>
    const game = document.getElementById("game")
    const myShooter = document.getElementById("myShooter")
    const asteroid1 = document.getElementById("asteroid1")
    const asteroid2 = document.getElementById("asteroid2")
    const asteroid3= document.getElementById("asteroid3")
    const asteroid4 = document.getElementById("asteroid4")
    const gameWhere = game.getBoundingClientRect()
    const gameLeft = gameWhere.left
    const asteroidWhere1 = asteroid1.getBoundingClientRect()
    const asteroidWhere2 = asteroid2.getBoundingClientRect()
    const asteroidWhere3 = asteroid3.getBoundingClientRect()
    const asteroidWhere4 = asteroid4.getBoundingClientRect()
    const asteroid1Left = asteroidWhere1.left - gameLeft
    const asteroid1Right = asteroidWhere1.right - gameLeft
    const asteroid2Left = asteroidWhere2.left - gameLeft
    const asteroid2Right = asteroidWhere2.right - gameLeft
    const asteroid3Left = asteroidWhere3.left - gameLeft
    const asteroid3Right = asteroidWhere3.right - gameLeft
    const asteroid4Left = asteroidWhere4.left - gameLeft
    const asteroid4Right = asteroidWhere4.right - gameLeft
   
    let bullets = []
    let left = 0;
    let countBullet = 0;
    let direction = 1;
    function moveShooter() {
        const gameWidth = document.getElementById("game").offsetWidth;
        const shooterWidth = document.getElementById("myShooter").offsetWidth;
        left += direction * 2;
        if (left + shooterWidth >= gameWidth || left <= 0) {
            direction *= (-1);
        }
        myShooter.style.left = left + 'px'
    }

    function myBullets() {
        countBullet++
        let name = "myBullet" + countBullet;
        const myBullet = document.createElement("img")
        myBullet.id = name
        myBullet.src = "images/bulletMine.png"
        myBullet.style.width = "1vw";
        myBullet.style.position = "absolute"
        myBullet.style.left = left + 22 + 'px';
        myBullet.style.bottom = "25vh";
        game.appendChild(myBullet);
        bullets.push(myBullet)
    }

    function moveBullets() {
        for (bullet of bullets) {
            let bottomStr = bullet.style.bottom
            console.log("bottomstr", bottomStr)
            console.log("bottom", bottomStr.slice(0, -2))
            if (bottomStr.endsWith("vh")) {
            bottomStr = bullet.style.bottom.slice(0,-2)
            } else {
                continue
            }
            let bottom = parseFloat(bottomStr, 10)
            bottom += 2
            if (bottom >= 88) {
                bullet.remove()
            } else {
            bullet.style.bottom = bottom + 'vh';
            }
        }
    }

    function gameLoop() {
        moveShooter()
        if (left % 15 === 0 && !((left > asteroid1Left && left < asteroid1Right) || (left > asteroid2Left && left < asteroid2Right) || (left > asteroid3Left && left < asteroid3Right) || (left > asteroid4Left && left < asteroid4Right)) ) {
        myBullets()
        }
        moveBullets()
        requestAnimationFrame(gameLoop)
    }

   gameLoop()

</script>

<script>
    myShip = document.getElementById("myShip")
    let movingRight = false;
    let movingLeft = false;

    document.addEventListener("keydown", (event) => {
        if (event.key === "ArrowLeft") {
            movingLeft = true;
        } else if (event.key === "ArrowRight") {
            movingRight = true;
        }
    })

    document.addEventListener("keyup", (event) => {
        if (event.key === "ArrowLeft") {
            movingLeft = false;
        } else if (event.key === "ArrowRight") {
            movingRight = false;
        }
    })

    const myShipWidth = myShip.offsetWidth;
    const gameWidth = document.getElementById("game").offsetWidth;

    let startPosition = 0 + gameWidth / 2;
    let leftMostPosition = 0 + myShipWidth/2;

    function moveShip() {
        let left = parseInt(myShip.style.left || startPosition,10)
        if (movingLeft) {
            left -= 4;
        } else if (movingRight) {
            left += 4;
       
        }
        left = Math.max(leftMostPosition, Math.min(left, gameWidth - myShipWidth / 2))
        myShip.style.left = left + 'px';
        requestAnimationFrame(moveShip);
    }
    moveShip()
</script>
</html>